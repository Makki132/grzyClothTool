<Window x:Class="grzyClothTool.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:helpers="clr-namespace:grzyClothTool.Helpers"
        xmlns:icons="clr-namespace:Material.Icons.WPF;assembly=Material.Icons.WPF"
        xmlns:scm="clr-namespace:System.ComponentModel;assembly=WindowsBase"
        xmlns:constants="clr-namespace:grzyClothTool"
        d:DataContext="{d:DesignInstance Type=helpers:NavigationHelper, IsDesignTimeCreatable=True}"
        mc:Ignorable="d"
        Background="{DynamicResource Brush50}"
        Title="grzyClothTool" Height="800" Width="1200" MinWidth="800" MinHeight="400"
        MouseDown="Window_MouseDown"
        Closed="Window_Closed"
        Closing="Window_Closing"
        >

    <Window.Resources>
        <CollectionViewSource x:Key="SortedSaveFiles" Source="{Binding SaveFiles}">
            <CollectionViewSource.SortDescriptions>
                <scm:SortDescription PropertyName="SaveDate" Direction="Descending"/>
            </CollectionViewSource.SortDescriptions>
        </CollectionViewSource>
    </Window.Resources>

    <DockPanel>
        <!-- Top Menu Bar -->
        <Grid DockPanel.Dock="Top" Background="{DynamicResource Brush100}" Height="26">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            
            <!-- Menu Items -->
            <Menu Grid.Column="0" Background="Transparent" BorderThickness="0" VerticalAlignment="Center">
                <!-- Project Menu -->
                <MenuItem Header="Project" Padding="10,4">
                    <MenuItem Header="New" Click="CreateNew_Click">
                        <MenuItem.Icon>
                            <icons:MaterialIcon Kind="Plus" Width="16" Height="16" />
                        </MenuItem.Icon>
                    </MenuItem>
                    <MenuItem Header="Open" Click="OpenAddon_Click">
                        <MenuItem.Icon>
                            <icons:MaterialIcon Kind="FolderOpen" Width="16" Height="16" />
                        </MenuItem.Icon>
                    </MenuItem>
                    <MenuItem Header="Recent Projects" ItemsSource="{Binding Source={StaticResource SortedSaveFiles}}">
                        <MenuItem.Icon>
                            <icons:MaterialIcon Kind="History" Width="16" Height="16" />
                        </MenuItem.Icon>
                        <MenuItem.ItemTemplate>
                            <DataTemplate>
                                <TextBlock MouseUp="OpenSave_Click">
                                    <TextBlock.Text>
                                        <MultiBinding StringFormat="{}Auto-save ({0:dd.MM.yyyy HH:mm:ss})">
                                            <Binding Path="SaveDate" />
                                        </MultiBinding>
                                    </TextBlock.Text>
                                    <TextBlock.Tag>
                                        <Binding />
                                    </TextBlock.Tag>
                                </TextBlock>
                            </DataTemplate>
                        </MenuItem.ItemTemplate>
                    </MenuItem>
                    <Separator />
                    <MenuItem Header="Save" Click="Save_Click">
                        <MenuItem.Icon>
                            <icons:MaterialIcon Kind="ContentSave" Width="16" Height="16" />
                        </MenuItem.Icon>
                    </MenuItem>
                    <MenuItem Header="Save As..." Click="SaveAs_Click">
                        <MenuItem.Icon>
                            <icons:MaterialIcon Kind="ContentSaveAll" Width="16" Height="16" />
                        </MenuItem.Icon>
                    </MenuItem>
                    <Separator />
                    <MenuItem Header="Import Project" Click="ImportProject_Click">
                        <MenuItem.Icon>
                            <icons:MaterialIcon Kind="Import" Width="16" Height="16" />
                        </MenuItem.Icon>
                    </MenuItem>
                    <MenuItem Header="Export Project" Click="ExportProject_Click">
                        <MenuItem.Icon>
                            <icons:MaterialIcon Kind="Export" Width="16" Height="16" />
                        </MenuItem.Icon>
                    </MenuItem>
                </MenuItem>
                
                <!-- Options Menu -->
                <MenuItem Header="Options" Padding="10,4">
                    <MenuItem Header="Settings" Tag="Settings" Click="Navigation_Click">
                        <MenuItem.Icon>
                            <icons:MaterialIcon Kind="Cog" Width="16" Height="16" />
                        </MenuItem.Icon>
                    </MenuItem>
                </MenuItem>
                
                <!-- View Menu -->
                <MenuItem Header="View" Padding="10,4">
                    <MenuItem Header="Error List" Click="ErrorList_Click">
                        <MenuItem.Icon>
                            <icons:MaterialIcon Kind="AlertCircleOutline" Width="16" Height="16" />
                        </MenuItem.Icon>
                    </MenuItem>
                    <MenuItem Header="Logs" Click="LogsOpen_Click">
                        <MenuItem.Icon>
                            <icons:MaterialIcon Kind="TextBox" Width="16" Height="16" />
                        </MenuItem.Icon>
                    </MenuItem>
                </MenuItem>
                
                <!-- Help Menu -->
                <MenuItem Header="Help" Padding="10,4">
                    <MenuItem Header="Documentation" Click="Documentation_Click">
                        <MenuItem.Icon>
                            <icons:MaterialIcon Kind="Book" Width="16" Height="16" />
                        </MenuItem.Icon>
                    </MenuItem>
                    <MenuItem Header="Discord Community" Click="Discord_Click">
                        <MenuItem.Icon>
                            <icons:MaterialIcon Kind="Chat" Width="16" Height="16" />
                        </MenuItem.Icon>
                    </MenuItem>
                    <Separator />
                    <MenuItem Header="About" Click="About_Click">
                        <MenuItem.Icon>
                            <icons:MaterialIcon Kind="Information" Width="16" Height="16" />
                        </MenuItem.Icon>
                    </MenuItem>
                </MenuItem>
            </Menu>
            
            <!-- Version Info -->
            <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,10,0">
                <TextBlock x:Name="versionText" Text="Version 1.0.4" Foreground="{DynamicResource Brush700}" FontSize="11" VerticalAlignment="Center" Margin="0,0,4,0" />
                <icons:MaterialIcon Kind="Check" Width="14" Height="14" Foreground="{DynamicResource SuccessBrush}" VerticalAlignment="Center" />
            </StackPanel>
        </Grid>

        <!-- Bottom Toolbar -->
        <Grid DockPanel.Dock="Bottom" Background="{DynamicResource Brush100}" Height="28">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            
            <!-- Status Message Area (Left) -->
            <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center" Margin="8,0">
                <icons:MaterialIcon x:Name="logBarIcon" Visibility="Hidden" Width="16" Height="16" Foreground="{DynamicResource Brush900}" Margin="0,0,6,0" />
                <TextBlock x:Name="logBar" Foreground="{DynamicResource Brush900}" FontSize="12" VerticalAlignment="Center" TextTrimming="CharacterEllipsis" />
            </StackPanel>
            
            <!-- Action Buttons (Right) -->
            <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,8,0">
                <!-- 3D Preview Button -->
                <Button x:Name="previewButton" Click="Preview_Click" Style="{StaticResource ModernButton}" Padding="8,4" Margin="0,0,4,0" ToolTip="3D Preview">
                    <StackPanel Orientation="Horizontal">
                        <icons:MaterialIcon Kind="CubeOutline" Width="16" Height="16" VerticalAlignment="Center" Margin="0,0,4,0" />
                        <TextBlock Text="3D Preview" VerticalAlignment="Center" FontSize="12" />
                    </StackPanel>
                </Button>
                
                <!-- Error List Button with Badge -->
                <Button x:Name="errorListButton" Click="ErrorList_Click" Style="{StaticResource ModernButton}" Padding="8,4" Margin="0,0,4,0" ToolTip="Error List">
                    <Grid>
                        <StackPanel Orientation="Horizontal">
                            <icons:MaterialIcon Kind="AlertCircleOutline" Width="16" Height="16" VerticalAlignment="Center" Margin="0,0,4,0" />
                            <TextBlock Text="Error List" VerticalAlignment="Center" FontSize="12" />
                        </StackPanel>
                        <!-- Error Count Badge -->
                        <Border x:Name="errorBadge" Background="{DynamicResource ErrorBrush}" CornerRadius="8" Width="16" Height="16" 
                                HorizontalAlignment="Right" VerticalAlignment="Top" Margin="0,-8,-8,0" Visibility="Collapsed">
                            <TextBlock x:Name="errorCount" Text="0" Foreground="White" FontSize="10" FontWeight="Bold" 
                                       HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                    </Grid>
                </Button>
                
                <!-- Settings Button -->
                <Button x:Name="settingsButton" Click="Settings_Click" Style="{StaticResource ModernButton}" Padding="8,4" Margin="0,0,4,0" ToolTip="Settings">
                    <StackPanel Orientation="Horizontal">
                        <icons:MaterialIcon Kind="Cog" Width="16" Height="16" VerticalAlignment="Center" Margin="0,0,4,0" />
                        <TextBlock Text="Settings" VerticalAlignment="Center" FontSize="12" />
                    </StackPanel>
                </Button>
                
                <!-- Build Project Button -->
                <Button x:Name="buildButton" Click="BuildProject_Click" Style="{StaticResource AccentButton}" Padding="8,4" ToolTip="Build Project">
                    <StackPanel Orientation="Horizontal">
                        <icons:MaterialIcon Kind="Hammer" Width="16" Height="16" VerticalAlignment="Center" Margin="0,0,4,0" />
                        <TextBlock Text="Build project" VerticalAlignment="Center" FontSize="12" />
                    </StackPanel>
                </Button>
            </StackPanel>
            
            <!-- Progress Bar Overlay -->
            <ProgressBar x:Name="progressBar" Grid.ColumnSpan="2" BorderBrush="Transparent" Height="2" Visibility="Hidden" 
                         IsIndeterminate="True" VerticalAlignment="Bottom" Background="Transparent" 
                         Foreground="{DynamicResource AccentBlueBrush}" />
        </Grid>

        <Grid Margin="5,5,5,5">
            <ContentControl x:Name="MainWindowContentControl" Content="{Binding CurrentPage}" />
        </Grid>

    </DockPanel>
</Window>
